<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>SooshARPG | ARPG Mod Tools</title>
  <link rel="shortcut icon" type="image/png" href="img/favicon.png"/>
  
  <!-- CSS Stylesheet -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="css/mod.css" />
</head>
<body>
  <div class="container">
    <div class="row">
      <div class="col-md-6 col-md-offset-3">
        <div class="well well-sm">
          <form class="form-horizontal" action="" method="post">
          <fieldset>
            <legend class="text-center">Dailies Rolling</legend>
            
            <!-- DailyType input-->
            <div class="form-group">
              <label class="col-md-3 control-label" for="dailyType">Daily Type</label>
              <div class="col-md-9">
                <select id="dailyType" class="form-control">
                  <option value="crafting">Crafting</option>
                  <option value="hunting">Hunting</option>
                  <option value="fishing">Angling</option>
                  <option value="mining">Mining</option>
                  <option value="woodcutting">Woodcutting</option>
                  <option value="gathering">Gathering</option>
                </select>
              </div>
            </div>
    
            <!-- Location input-->
            <div class="form-group">
              <label class="col-md-3 control-label" for="locationType">Location</label>
              <div class="col-md-9">
                <select id="locationType" class="form-control">
                  <option value="thickets">The Thickets</option>
                  <option value="midwoods">The Midwoods</option>
                  <option value="thorns">The Thorns</option>
                  <option value="solitude">Mount Solitude</option>
                  <option value="reflections">Lake of Reflections</option>
                </select>
              </div>
            </div>
            
            <!-- Name input-->
            <div class="form-group">
              <label class="col-md-3 control-label" for="sooshName">Soosh's Name</label>
              <div class="col-md-9">
                <input type="text" class="form-control" id="sooshName">
              </div>
            </div>
            
            <!-- Soosh Skill input-->
            <div class="form-group">
              <label class="col-md-3 control-label" for="skillLevel">Soosh's Skill Level</label>
              <div class="col-md-9">
                <select id="skillLevel" class="form-control">
                  <option value="0">Novice/Rookie</option>
                  <option value="1">Apprentice</option>
                  <option value="2">Whiz</option>
                  <option value="3">Genius</option>
                  <option value="4">Master</option>
                  <option value="5">Hero</option>
                </select>
              </div>
            </div>
    
            <!-- Button -->
            <div class="form-group">
              <div class="col-md-12 text-right">
                <button type="button" class="btn btn-primary btn-block" onclick="rollDaily()">Roll Daily</button>
              </div>
            </div>
            
            <!-- Daily Result textarea -->
            <div class="form-group">
              <label class="col-md-3 control-label" for="dailyOutput">Daily Result</label>
              <div class="col-md-9">
                <textarea class="form-control" id="dailyOutput" name="message" rows="5"></textarea>
              </div>
            </div>
            
            <!-- Daily Result textarea -->
            <div class="form-group">
              <label class="col-md-3 control-label" for="debugOutput">DEBUGGING</label>
              <div class="col-md-9">
                <textarea class="form-control" id="debugOutput" name="message" rows="5"></textarea>
              </div>
            </div>
          </fieldset>
          </form>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Javascript -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <script src="js/taffy.js"></script>
  <script src="js/DAILIESDB.js"></script>
  <script>
  // ------------------------------------------------------------------
  // dice roller helper function
  function rollDie(dieSize) {
    return Math.floor((Math.random() * dieSize) + 1);
  }
  
  // ------------------------------------------------------------------
  // generate random index for selecting item obtained
  function rIndex(itemNum) {
    return Math.floor((Math.random() * itemNum));
  }
  
  // ------------------------------------------------------------------
  // helper function for determining the amount of exp earned
  function getExp(quantity, rarity) {
    var exp = quantity * 10;
    if (rarity == "uncommon") { exp += 5; }
    else if (rarity == "rare") { exp += 10; }
    return exp;
  }
  
  // ------------------------------------------------------------------
  // helper function for returning whatever item is returned from DBresults
  function getItem(DBresults) {
    if (DBresults.length == 0) {
      return "There are no items that satisfy these conditions";
    } else {
      return DBresults[rIndex(DBresults.length)];
    }
  }
  
  // ------------------------------------------------------------------
  // generate formalized output. Helper function to help declutter rollDaily
  function printFormalOutput(sooshName, dailyType, loc, quantity, item, rarity, buff) {
    if (loc == "thickets") { loc = "The Thickets"; }
    else if (loc == "midwoods") { loc = "The Midwoods"; }
    else if (loc == "thorns") { loc = "The Thorns"; }
    else if (loc == "solitude") { loc = "Mount Solitude"; }
    else if (loc == "reflections") { loc = "The Lake of Reflections"; }
    formalStr = "<small>" + sooshName + " went " + dailyType + " in " + loc + ".\n";
    if (quantity > 0) {
      formalStr += "They managed to find <b>" + quantity.toString() + " " + item + "</b>!\n";
      formalStr += "They are awarded <b>" + getExp(quantity,rarity).toString() + " exp</b>."
    } else {
      formalStr += "Unfortunately they didnâ€™t find anything, maybe next time!"
    }
    if (buff != "") { formalStr += "\n" + buff; }
    formalStr += "</small>";
    return formalStr;
  }
  
  // ------------------------------------------------------------------
  // function for calculating daily rolls
  function rollDaily() {
    var sooshName = document.getElementById("sooshName").value;
    if (sooshName == "") { sooshName = "SOOSHNAME"; }
    var dailyType = document.getElementById("dailyType").options[document.getElementById("dailyType").selectedIndex].value;
    var loc = document.getElementById("locationType").value;
    var quantity = 0;
    var item = "";
    var rarity = "";
    var buff = "";
    var bonus = parseInt(document.getElementById("skillLevel").value);
    var DBresults;
    var finalString = ""; // KEEP IN HERE FOR DEBUGGING
    // ------------------------------------------------------------------
    // crafting
    if (dailyType == "crafting") {
      result = rollDie(20) + bonus;
      finalString = result;
      finalString += ": ";
      if (result == 1) {
        finalString += "failure and negative debuff";
      } else if ((result >= 2) && (result <= 8)) {
        finalString += "straight failure";
      } else if ((result >= 9) && (result <= 12)) {
        finalString += "failure but creates new item";
      } else if ((result >= 13) && (result <= 19)) {
        finalString += "success";
      } else if (result >= 20) {
        finalString += "success and a buff for the next time they craft";
      }
    // ------------------------------------------------------------------
    // hunting and fishing
    } else if ((dailyType == "hunting") || (dailyType == "fishing")) {
      result = rollDie(20) + bonus;
      if (result == 1) {
        buff = "a dizziness debuff";
        // standard failure if between 2 and 6
      } else if ((result >= 7) && (result <= 12)) {
        var DBresults;
        if (dailyType == "fishing") { DBresults = anglingDB({location:loc,rarity:"common"}).select("name"); }
        else { DBresults = huntingDB({location:loc,difficulty:"easy"}).select("name"); }
        rarity = "common";
        quantity = 1;
        item = getItem(DBresults);
      } else if ((result >= 13) && (result <= 16)) {
        if (dailyType == "fishing") { DBresults = anglingDB({location:loc,rarity:"uncommon"}).select("name"); }
        else { DBresults = huntingDB({location:loc,difficulty:"medium"}).select("name"); }
        rarity = "uncommon";
        quantity = 1;
        item = getItem(DBresults);
      } else if ((result >= 17) && (result <= 19)) {
        if (dailyType == "fishing") { DBresults = anglingDB({location:loc,rarity:"rare"}).select("name"); }
        else { DBresults = huntingDB({location:loc,difficulty:"hard"}).select("name"); }
        rarity = "rare";
        quantity = 1;
        item = getItem(DBresults);
      } else if (result >= 20) {
        if (dailyType == "fishing") {
          buff = "a buff for the next time they go fishing";
          DBresults = anglingDB({location:loc,rarity:"rare"}).select("name");
        } else {
          buff = "a buff for the next time they go hunting";
          DBresults = huntingDB({location:loc,difficulty:"hard"}).select("name");
        }
        rarity = "rare";
        quantity = 1;
        item = getItem(DBresults);
      }
    // ------------------------------------------------------------------
    // mining and woodcutting
    } else if ((dailyType == "mining") || (dailyType == "woodcutting")) {
      result_one = rollDie(20) + bonus;
      result_two = rollDie(20);
      if (result_one == 1) {
        buff = "a negative debuff";
        // standard failure if between 2 and 6
      } else if ((result_one >= 7) && (result_one <= 12)) {
        if (dailyType == "mining") { DBresults = miningDB({location:loc,rarity:"common"}).select("name"); }
        else { DBresults = woodcuttingDB({location:loc,difficulty:"easy"}).select("logName"); }
        rarity = "common";
        item = getItem(DBresults);
      } else if ((result_one >= 13) && (result_one <= 16)) {
        if (dailyType == "mining") { DBresults = miningDB({location:loc,rarity:"uncommon"}).select("name"); }
        else { DBresults = woodcuttingDB({location:loc,difficulty:"medium"}).select("logName"); }
        rarity = "uncommon";
        item = getItem(DBresults);
      } else if ((result_one >= 17) && (result_one <= 19)) {
        if (dailyType == "mining") { DBresults = miningDB({location:loc,rarity:"rare"}).select("name"); }
        else { DBresults = woodcuttingDB({location:loc,difficulty:"hard"}).select("logName"); }
        rarity = "rare";
        item = getItem(DBresults);
      } else if (result_one >= 20) {
        if (dailyType == "mining") {
          buff = "positive buff for the next time they go mining";
          DBresults = miningDB({location:loc,rarity:"rare"}).select("name");
        } else {
          buff = "positive buff for the next time they go woodcutting";
          DBresults = woodcuttingDB({location:loc,difficulty:"hard"}).select("logName");
        }
        rarity = "rare";
        item = getItem(DBresults);
      }
      if ((result_two >= 1) && (result_two <= 6)) {
        quantity = 1;
      } else if ((result_two >= 6) && (result_two <= 10)) {
        quantity = 2;
      } else if ((result_two >= 11) && (result_two <= 15)) {
        quantity = 3;
      } else if ((result_two >= 16) && (result_two <= 19)) {
        quantity = 4;
      } else if (result_two == 20) {
        quantity = 5;
      }
    // ------------------------------------------------------------------
    // gathering
    } else if (dailyType == "gathering") {
      var DBresults;
      result_one = rollDie(20) + bonus;
      result_two = rollDie(6);
      result_three = rollDie(20);
      if (result_one == 1) {
        buff = "negative debuff";
        // standard failure if between 2 and 6
      } else if ((result_one >= 7) && (result_one <= 12)) {
        rarity = "common";
      } else if ((result_one >= 13) && (result_one <= 16)) {
        rarity = "uncommon";
      } else if ((result_one >= 17) && (result_one <= 19)) {
        rarity = "rare";
      } else if (result_one >= 20) {
        buff = "positive buff for the next time they go gathering";
        rarity = "rare";
      }
      if (result_one >= 7) {
        if (result_two == 1) {
          DBresults = gatheringDB({location:loc,rarity:rarity,type:"flower"}).select("name");
          DBresults = DBresults.concat(gatheringDB({location:loc,rarity:rarity,type:"plant"}).select("name"));
        } else if (result_two == 2) {
          DBresults = gatheringDB({location:loc,rarity:rarity,type:"small animal items/drops"}).select("name");
        } else if (result_two == 3) {
          DBresults = gatheringDB({location:loc,rarity:rarity,type:"fruit"}).select("name");
          DBresults = DBresults.concat(gatheringDB({location:loc,rarity:rarity,type:"vegetable"}).select("name"));
          DBresults = DBresults.concat(gatheringDB({location:loc,rarity:rarity,type:"berry"}).select("name"));
        } else if (result_two == 4) {
          DBresults = gatheringDB({location:loc,rarity:rarity,type:"crafting"}).select("name");
        } else if (result_two == 5) {
          DBresults = gatheringDB({location:loc,rarity:rarity,type:"miscellaneous"}).select("name");
        } else if (result_two == 6) {
          DBresults = gatheringDB({location:loc,rarity:rarity,type:"treasures"}).select("name");
        }
        if ((result_three >= 1) && (result_three <= 6)) {
          quantity = 1;
        } else if ((result_three >= 6) && (result_three <= 10)) {
          quantity = 2;
        } else if ((result_three >= 11) && (result_three <= 15)) {
          quantity = 3;
        } else if ((result_three >= 16) && (result_three <= 19)) {
          quantity = 4;
        } else if (result_three == 20) {
          quantity = 5;
        }
        item = getItem(DBresults);
      }
    }
    document.getElementById("debugOutput").innerHTML = finalString;
    document.getElementById("dailyOutput").innerHTML = printFormalOutput(sooshName, dailyType, loc, quantity, item, rarity, buff);
  }
  </script>
</body>
</html>