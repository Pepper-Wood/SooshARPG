
<!DOCTYPE html>
<html lang="en">
<head>
  <title>Visual Trade Center</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Stylesheets -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <link rel="stylesheet" href="css/newtradecenter.css">
</head>
<body>
  <div class="container" style="background-color:rgba(255,255,255,0.7);min-height:1000px">
    <h2 style="text-align:center;border-radius:10px">Visual Trade Center</h2>
    <div class="container">
      <div class="row">
        <p>White BG indicates an approved listing on the <a target="_blank" href="http://sushidogs.deviantart.com/journal/Trade-Center-547532152">Sushidogs Trade Center</a></p>
        <p>Yellow BG indicates this listing is not officially recognized yet by the Sushidog group. Be careful in the event these trades are scams.</p>
        <p>Red soosh food name indicates that this soosh is not in the <a target="_blank" href="http://sooshdatabase.deviantart.com">SooshDatabase</a>. These sooshes are valid sushidogs and just need to be put on the sooshDatabase before a trade can occur.</p>
      </div>
    </div>

    <div class="container" style="margin-bottom: 10px;">
      <div class="row">
        <div class="btn-group">
          <div class="btn-group">
              <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" id="typeMenuButton">
              	Filter Type By <span class="caret"></span>
              </button>
              <ul class="dropdown-menu" role="menu" id="typeMenu">
                <li><a href="#witchpaws">Witchpaws/SpikedPeach</a></li>
                <li><a href="#other">Offical Guest Artist / MYO</a></li>
                <li class="divider"></li>
                <li><a href="#allTypes">All Types</a></li>
              </ul>
          </div>
          <div class="btn-group">
              <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" id="offerMenuButton">
              	<span id="search_concept_offer">Filter Offers By</span> <span class="caret"></span>
              </button>
              <ul class="dropdown-menu" role="menu" id="offerMenu">
                <li><a href="#trade" style="color: #5cb85c">Trade</a></li>
                <li><a href="#swap" style="color: #5cb85c">Soosh Swaps Only</a></li>
                <li><a href="#sale" style="color: #d9534f">Sale</a></li>
                <li><a href="#contest" style="color: #337ab7">Contest</a></li>
                <li class="divider"></li>
                <li><a href="#allOffers">All Offers</a></li>
              </ul>
          </div>
          <button class="btn btn-info" type="button" id="filterButton"><span class="glyphicon glyphicon-search"></span> Search</button>
        </div>
      </div>
    </div>

    <div id="loaderBG"></div>
    <div id="loader"></div>
    <div id="sooshOutput" style="display:none;"></div>
  </div>

  <!-- JavaScripts -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="js/tabletop.js"></script>
  <script src="js/taffy.js"></script>
  <script type="text/javascript">
    var public_spreadsheet_url = 'https://docs.google.com/spreadsheets/d/1H2KbU3vP8l03VNP-x8fcB9T7nEXyTo12qCsYHcrp3dY/pubhtml';
    // -----------------------------------------------------------------------------------------------------------------------
    function printSooshFlag(wp_userFlag, wp_sooshFlag, nonwp_userFlag, nonwp_sooshFlag, sale_userFlag, sale_sooshFlag, trade_userFlag, trade_sooshFlag, swap_userFlag, swap_sooshFlag, contest_userFlag, contest_sooshFlag) {
      if (wp_userFlag) { // user wants a wp soosh
        if (!wp_sooshFlag) { return false; } // but this is not a wp soosh
        else { // and this is a wp soosh
          if (sale_userFlag) { return sale_sooshFlag;
          } else if (trade_userFlag) { return trade_sooshFlag;
          } else if (swap_userFlag) { return swap_sooshFlag;
          } else if (contest_userFlag) { return contest_sooshFlag;
          } else { return true; } // user doesn't want second filter
        }
      } else if (nonwp_userFlag) { // user wants a non-wp soosh
        if (!nonwp_sooshFlag) { return false; } // but this is not a nonwp soosh
        else { // and this is a wp soosh
          if (sale_userFlag) { return sale_sooshFlag;
          } else if (trade_userFlag) { return trade_sooshFlag;
          } else if (swap_userFlag) { return swap_sooshFlag;
          } else if (contest_userFlag) { return contest_sooshFlag;
          } else { return true; } // user doesn't want second filter
        }
      } else {
        if (sale_userFlag) { return sale_sooshFlag;
        } else if (trade_userFlag) { return trade_sooshFlag;
        } else if (swap_userFlag) { return swap_sooshFlag;
        } else if (contest_userFlag) { return contest_sooshFlag;
        } else { return true; } // user doesn't want second filter
      }
    }

    // -----------------------------------------------------------------------------------------------------------------------
    $(document).ready( function() {
      Tabletop.init( { key: public_spreadsheet_url,
                       callback: showInfo,
                       simpleSheet: true } );

      $("#typeMenu li a").click(function(){
        $("#typeMenuButton").text($(this).text());
        $("#typeMenuButton").val($(this).text());
        $("#typeMenuButton").css("background-color","#ffecb3");
      });
      $("#offerMenu li a").click(function(){
        $("#offerMenuButton").text($(this).text());
        $("#offerMenuButton").val($(this).text());
        $("#offerMenuButton").css("background-color","#ffecb3");
      });
    });

    // -----------------------------------------------------------------------------------------------------------------------
    function showInfo(data, tabletop) {
      // PARSE GOOGLE SHEETS INTO TAFFYDB
      var tradeCenter = TAFFY();
      $.each( tabletop.sheets("Sheet1").all(), function(i, soosh) {
        tradeCenter.insert({ "wp":soosh.wp,
                             "sooshName":soosh.sooshName,
                             "masterlistUrl":soosh.masterlistUrl,
                             "imgUrl":soosh.imgUrl,
                             "lookingFor":soosh.lookingFor,
                             "swap":soosh.swap,
                             "seeking":soosh.seeking,
                             "journalLink":soosh.journalLink,
                             "removeDate":soosh.removeDate,
                             "official":soosh.official
        });
      });

      // OUTPUT FLAGS
      var wp_check = ($("#typeMenuButton").val() == "Witchpaws/SpikedPeach");
      var nonwp_check = ($("#typeMenuButton").val() == "Offical Guest Artist / MYO");
      var sale_check = ($("#offerMenuButton").val() == "Sale");
      var trade_check = ($("#offerMenuButton").val() == "Trade");
      var swap_check = ($("#offerMenuButton").val() == "Soosh Swaps Only");
      var contest_check = ($("#offerMenuButton").val() == "Contest");

      // PARSE TAFFYDB FOR RESULTS
      var sooshOutput = "<div class='row'>";
      // add row css depending on viewing window
      tradeCenter().order("sooshName asec").each(function (soosh) {
        // print this soosh if user wants wp and this is wp soosh AND user wants contest and this soosh is contest
        if (printSooshFlag(wp_check, ((soosh.wp).includes("x")), nonwp_check, (!((soosh.wp).includes("x"))), sale_check, ((soosh.lookingFor).includes("sale")), trade_check, ((soosh.lookingFor).includes("trade")), swap_check, ((soosh.swap).includes("x")), contest_check, ((soosh.lookingFor).includes("contest")))) {
          sooshOutput += "<div class='col-xs-6 col-md-3 reducedPadding'>";
          if ((soosh.official).includes("no")) { sooshOutput += "<div class='sooshCard' style='background-color:#ffe082'>"; }
          else { sooshOutput += "<div class='sooshCard'>"; }
          sooshOutput += "<a target='_blank' href='" + soosh.journalLink +"'>";
          if ((soosh.official).includes("no")) { sooshOutput += "<div class='sooshImg'>"; }
          else { sooshOutput += "<div class='sooshImg'>"; }
          sooshOutput += "<img class='object-fit_contain' src='" + soosh.imgUrl + "'>";
          sooshOutput += "<div style='position:absolute;top:0px;left:0px;'>"
          if ((soosh.lookingFor).includes("sale")) { sooshOutput += "<button type='button' class='btn btn-danger'>Sale</button>"; }
          if ((soosh.lookingFor).includes("trade")) { sooshOutput += "<button type='button' class='btn btn-success'>Trade</button>"; }
          if ((soosh.lookingFor).includes("contest")) { sooshOutput += "<button type='button' class='btn btn-primary'>Contest</button>"; }
          //sooshOutput += "<p style='position:absolute;bottom:0px;left:0px;'><b><a target='_blank' href='" + soosh.masterlistUrl + "'>" + soosh.sooshName + "</a></b></p>";
          sooshOutput += "</div><div class='description'>";
          if ((soosh.masterlistUrl).includes("UNLISTED")) {
            sooshOutput += "<a href=''><p class='description_content' style='background-color: #ff0000;'>" + soosh.sooshName + "</p></a>";
          } else {
            sooshOutput += "<a target='_blank' class='sooshDatabaseURL' href='" + soosh.masterlistUrl + "'><p class='description_content'>" + soosh.sooshName + "</p></a>";
          }
          sooshOutput += "<p class='lookingFor_content'><b>LF:</b> " + soosh.seeking + "</p></div>";
          sooshOutput += "</div></a>";
          sooshOutput += "</div></div>";
        }
      });
      // get rid of loader and replace with content
      sooshOutput += "</div>";
      $("#loaderBG").fadeOut();
      $("#loader").toggle();
      $("#sooshOutput").html(sooshOutput);
      $("#sooshOutput").fadeIn();
    }

    // -----------------------------------------------------------------------------------------------------------------------
    $( "#filterButton" ).click(function() {
      $("#loaderBG").toggle();
      $("#loader").toggle();
      Tabletop.init( { key: public_spreadsheet_url,
                       callback: showInfo,
                       simpleSheet: true } )
    });
  </script>
</body>
</html>
